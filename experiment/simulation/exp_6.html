<!DOCTYPE html>
<html>
<style>
input[type=text], select {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}

input[type=button]{
  width: 100%;
  background-color: #671834;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

input[type=button]:hover {
  background-color: #3E0719;
}
h4 {
  text-align: center;
}

div {
	text-align: center;
}
</style>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title><b>FILE FORMAT CONVERSTION</b></title>

</head>

<body>
	<p id="demo"></p>
	<h3>
		Select a file:
	</h3>

	<form id="myform"   >
		<label for="myfile">Upload the file:</label>
		<input type="file" id="file", accept=".txt" required  multiple />
		<br>
		<p id = "outputBx"></p>
		
		<br>
	
		<label for="File from">Convert file from:</label>
		<select name="Filefrom-name" id="Filefrom-name">
	   		<option value="EMBL">EMBL</option>
  			<option value="GENBANK">GENBANK</option> 
		</select>	
		<br>

 		<label for="File to">Required file format:</label>
		<select name="Fileto-name" id="Fileto-name">
			<option value="embl">EMBL</option>
  			<option value="genbank">GENBANK</option> 
  			<option value="fasta">FASTA</option> 
		</select>
	
	 	<input type="button" onclick="output(myform.file)" value="Submit" >
	</form><br><br>

	<pre id="result"></pre>

<script>

	document.getElementById("file").onchange = function() {
		let inpfil = file.files[0];
  		let reader1 = new FileReader();

  		reader1.readAsText(inpfil);
		reader1.onload = function() {
    		//document.getElementById("demo").innerHTML = reader.result;
    		let seq = reader1.result
    		//document.getElementById("demo").innerHTML = seq;
    		const array= seq.split("\n");
			if (array[0].includes('LOCUS')){
				document.getElementById("Filefrom-name").value= "GENBANK";
			}
			else if (array[0].includes('ID')){
				document.getElementById("Filefrom-name").value= "EMBL";
			}
			else {
				alert("Please input a genbank or fasta format");
			}
		}
    }

	function output(input){
		let file = input.files[0];
  		let reader = new FileReader();

  		reader.readAsText(file);
		reader.onload = function() {
    		//document.getElementById("demo").innerHTML = reader.result;
    		let seq = reader.result
    		//document.getElementById("demo").innerHTML = seq;
    		const array= seq.split("\n");
			if (array[0].includes('LOCUS')){
				document.getElementById("Filefrom-name").value= "GENBANK";
				if(document.getElementById("Fileto-name"). value== "fasta"){
					let definition= array[1];
    				let newDefinition = definition.replace("DEFINITION", "");
					newDefinition = newDefinition.replace(/(\r\n|\n|\r)/gm, "");
					newDefinition = newDefinition.replace(/\s/g, "");
    				//document.getElementById("demo").innerHTML = newDefinition;

    				let version= array[3];
    				let newVersion = version.replace("VERSION", "");
					newVersion = newVersion.replace(/(\r\n|\n|\r)/gm, "");
					newVersion = newVersion.replace(/\s/g, "");
  					//document.getElementById("demo").innerHTML = newVersion;

  					const sequence=[];
  					var len= array.length;
  					//document.getElementById("demo").innerHTML = len;
  					for (let i=0; i<=len; i++){
  						if (array[i].includes('ORIGIN')){
  							var k=0;
  							//document.getElementById("demo").innerHTML = i;
  							for (let j=i+1; j<len-1; j++){
  								//document.getElementById("demo").innerHTML = j;
  								sequence[k]= array[j];
  								k=k+1;
  								//document.getElementById("demo").innerHTML =sequence;		
  								//document.getElementById("demo").innerHTML =sequence.length;		
							}
							break;
  						} 	
									
  					}
  					var seqLen=sequence.length;
  					var newSeq= [];
  			 		//document.getElementById("demo").innerHTML =newSeq;
  					for (let n=0; n<seqLen; n++){
  						newSeq[n]= sequence[n].replace(/\s/g, "");
  						///	document.getElementById("demo").innerHTML =newSeq;
					}
					var newOrigin= newSeq.join('\n');
  					var newstr= newOrigin.replace(/\d/g, '');
					newstr=newstr.toUpperCase();
					const gen_fasta='>|'+newVersion+'|'+ newDefinition+'\n'+newstr;
					document.getElementById("result").innerHTML =("<h3> Results</h3>"+"\n"+gen_fasta);
					//document.getElementById("result").innerHTML =gen_fasta;
				
				};
			}
			else if(array[0].includes('ID')){
				document.getElementById("Filefrom-name").value= "EMBL";
				let orgmid= array[1];
    			let newOrgmid = orgmid.replace("AC   ", "");
    			//document.getElementById("demo").innerHTML =newOrgmid;
    			let acid = newOrgmid.substring(0,6);
    			let count = (newOrgmid.match(/;/g) || []).length;
				//document.getElementById("demo").innerHTML =count;

				let de= array[5];
    			let newDE = de.replace("DE   ", "");
    			newDE = newDE.replace(/(\r\n|\n|\r)/gm, "");
				newDE = newDE.replace(/\s/g, "");
    			//document.getElementById("demo").innerHTML =newDE;

    			const seq1=[];
    			var len1= array.length;
  				//document.getElementById("demo").innerHTML = len1;
  				for (let i=0; i<=len1; i++){
  					if (array[i].includes('SQ')){
  						var k=0;
  					//document.getElementById("demo").innerHTML = i;

  					for (let j=i+1; j<len1-1; j++){
  								//document.getElementById("demo").innerHTML = j;
  								seq1[k]= array[j];
  								k=k+1;
  								//document.getElementById("demo").innerHTML =seq1;		
  								//document.getElementById("demo").innerHTML =sequence.length;		
							}
							break;
  					}

  				}
  				var seqLen1=seq1.length;
  				var newSeq1= [];
  			 	//document.getElementById("demo").innerHTML =newSeq1;
  			 	for (let n=0; n<seqLen1; n++){
  					newSeq1[n]= seq1[n].replace(/\s/g, "");
  					//document.getElementById("demo").innerHTML =newSeq1;
					}
				var newEmbl= newSeq1.join('\n');
				//document.getElementById("demo").innerHTML =newEmbl;
				const embl_fasta='>|'+acid+'.'+count+'|'+ newDE +'\n'+newEmbl;
				document.getElementById("result").innerHTML =("<h3> Results</h3>"+"\n"+embl_fasta);


			}
		}
	}



</script>

</body>

</html>
